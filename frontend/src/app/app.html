<div class="layout" [class.sidebar-open]="sidebarOpen">
  <header class="topbar">
    <div class="logo">FastWoW</div>
    <nav class="main-nav">
      <a routerLink="/news" routerLinkActive="active">Noticias</a>
      <a routerLink="/forum" routerLinkActive="active">Foro</a>
      <a routerLink="/shop" routerLinkActive="active">Tienda</a>
      <a routerLink="/pvp" routerLinkActive="active">PvP</a>
      <a routerLink="/profile" routerLinkActive="active">Perfil</a>
    </nav>
    <button class="menu-toggle" type="button" (click)="sidebarOpen = !sidebarOpen" aria-label="Abrir/cerrar sidebar">☰</button>
  </header>
  <div class="body">
    <aside class="sidebar" [class.open]="sidebarOpen">
  <ng-container *ngIf="!isLogged(); else loggedBlock">
        <section class="widget">
          <h3>Acceso</h3>
          <form (submit)="doLogin(); $event.preventDefault();" class="auth-form">
            <input type="text" placeholder="Usuario" [(ngModel)]="loginData.username" name="lu" required />
            <input type="password" placeholder="Contraseña" [(ngModel)]="loginData.password" name="lp" required />
            <button type="submit">Login</button>
          </form>
          <a class="link-btn" routerLink="/register">Crear cuenta</a>
          <a class="small-link" routerLink="/recover">Recuperar contraseña</a>
        </section>
      </ng-container>
      <ng-template #loggedBlock>
  <section class="widget user-box" *ngIf="user() as u">
          <h3>Usuario</h3>
          <div class="user-info">
            <img [src]="u.gravatar" alt="avatar" class="avatar" />
            <div>
              <div class="username">{{ u.username }}</div>
              <div class="balances">
                <span class="vp">VP: {{ u.vote_points }}</span>
                <span class="cr">CR: {{ u.credits }}</span>
              </div>
            </div>
          </div>
          <button class="logout-btn" (click)="logout()">Logout</button>
        </section>
      </ng-template>
      <section class="widget">
        <h3>Siguiente voto</h3>
        <p class="text-muted">00:23:15</p>
      </section>
      <section class="widget">
        <h3>Realms</h3>
        <div *ngFor="let r of realmStatuses()" class="realm-item" [class.offline]="r.status!=='online'">
          <div class="realm-head">
            <span class="name">{{ r.name }} <span class="count">({{ r.online }})</span></span>
            <img class="exp" [src]="'images/expansion/' + (r.expansion || 3) + '.webp'" alt="exp" />
          </div>
          <div class="factions">
            <img class="fac" src="images/faction/1.png" alt="Alianza" [title]="'Alianza: '+ r.alliance" />
            <div class="bar" [title]="'Alianza: '+r.alliance+' / Horda: '+r.horde">
              <div class="seg alliance" [style.width.%]="factionPercent(r,'alliance')" [title]="'Alianza: '+r.alliance"></div>
              <div class="seg horde" [style.width.%]="factionPercent(r,'horde')" [title]="'Horda: '+r.horde"></div>
            </div>
            <img class="fac" src="images/faction/2.png" alt="Horda" [title]="'Horda: '+ r.horde" />
          </div>
        </div>
        <p class="small muted" *ngIf="!realmStatuses().length">Sin datos</p>
      </section>
    </aside>
    <main class="content">
      <router-outlet></router-outlet>
    </main>
  </div>
  <footer class="footer">© 2025 FastWoW - Todos los derechos reservados.</footer>
</div>
